name: REPORT

on:
  push:
    branches:
      - 'main'
    paths:
      - 'report/**'
      - '.github/workflows/report.yml'
  workflow_run:
    workflows: ["CLIENT"]
    types:
      - completed

defaults:
  run:
    working-directory: ./report

jobs:
  compile-report:
    if: ${{ github.event_name == 'push' || github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
    - name: Checkout 🛎️
      uses: actions/checkout@v3
      
    - name: Compile 📄
      uses: xu-cheng/latex-action@v2
      with:
        root_file: ./report.tex
        working_directory: ./report/
        
    - name: Move PDF ✂️
      run: mkdir ./build/ && cp ./report.pdf ./build/report.pdf
    
    - name: Deploy 🚀
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages
        folder: ./report/build/
        target-folder: ./report/
        clean: false
 
